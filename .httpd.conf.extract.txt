# Apache httpd.conf extract providing URL routing and other directives

#   Example usage in httpd.conf:
#   
#   # Assessments
#   Include /path/to/course-assessments/.httpd.conf.extract.txt
#   Use MacroCourseAssessments "/assessments" "Course assessments" "/path/to/course-assessments/:/path/to/php/libraries/"


<Macro MacroCourseAssessments $applicationBaseUrl $description $includePath>
	
	<Location $applicationBaseUrl>
		php_value include_path "$includePath"
	</Location>
	
	Use MacroFrontControllerApplication "$applicationBaseUrl/" "$description"
	
	RewriteEngine on
	RewriteRule ^$applicationBaseUrl/(rates|export|import).html$ $applicationBaseUrl/index.html?action=$1 [L]
	RedirectMatch permanent ^$applicationBaseUrl/([0-9]{4}-[0-9]{4})/(ia|ib|ii)/([^/]+)$ $applicationBaseUrl/$1/$2/$3/
	#!# This next one not currently working - not sure why
	RedirectMatch permanent ^$applicationBaseUrl/([0-9]{4}-[0-9]{4})/(ia|ib|ii)/([^/]+)/([^/]+)$ $applicationBaseUrl/$1/$2/$3/$4/
	RewriteRule ^$applicationBaseUrl/([0-9]{4}-[0-9]{4})/(ia|ib|ii)/([^/]+)/([^/]*)(/?)$ $applicationBaseUrl/index.html?action=data&year=$1&yeargroup=$2&module=$3&item=$4 [L]
	
	# Exports
	<Location $applicationBaseUrl/export.html>
		php_value auto_prepend_file none
		php_value auto_append_file none
	</Location>
	
</Macro>
